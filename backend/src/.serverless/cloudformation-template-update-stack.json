{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "The AWS CloudFormation template for this Serverless application",
  "Resources": {
    "ServerlessDeploymentBucket": {
      "Type": "AWS::S3::Bucket",
      "Properties": {
        "BucketEncryption": {
          "ServerSideEncryptionConfiguration": [
            {
              "ServerSideEncryptionByDefault": {
                "SSEAlgorithm": "AES256"
              }
            }
          ]
        }
      }
    },
    "ServerlessDeploymentBucketPolicy": {
      "Type": "AWS::S3::BucketPolicy",
      "Properties": {
        "Bucket": {
          "Ref": "ServerlessDeploymentBucket"
        },
        "PolicyDocument": {
          "Statement": [
            {
              "Action": "s3:*",
              "Effect": "Deny",
              "Principal": "*",
              "Resource": [
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "ServerlessDeploymentBucket"
                      },
                      "/*"
                    ]
                  ]
                },
                {
                  "Fn::Join": [
                    "",
                    [
                      "arn:",
                      {
                        "Ref": "AWS::Partition"
                      },
                      ":s3:::",
                      {
                        "Ref": "ServerlessDeploymentBucket"
                      }
                    ]
                  ]
                }
              ],
              "Condition": {
                "Bool": {
                  "aws:SecureTransport": false
                }
              }
            }
          ]
        }
      }
    },
    "GetTenantsLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-getTenants"
      }
    },
    "GetMenuLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-getMenu"
      }
    },
    "PutMenuItemLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-putMenuItem"
      }
    },
    "CreateOrderLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-createOrder"
      }
    },
    "GetOrderLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-getOrder"
      }
    },
    "ListOrdersLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-listOrders"
      }
    },
    "GetOrderMetricsLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-getOrderMetrics"
      }
    },
    "UpdateOrderStepLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-updateOrderStep"
      }
    },
    "GetDashboardSummaryLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-getDashboardSummary"
      }
    },
    "CheckOrderStatusLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-checkOrderStatus"
      }
    },
    "CalculateOrderMetricsLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-calculateOrderMetrics"
      }
    },
    "SendEmailNotificationLogGroup": {
      "Type": "AWS::Logs::LogGroup",
      "Properties": {
        "LogGroupName": "/aws/lambda/pardos-orders-dev-sendEmailNotification"
      }
    },
    "GetTenantsLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_tenants_menu/get_tenants.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-getTenants",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "GetTenantsLogGroup"
      ]
    },
    "GetMenuLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_tenants_menu/get_menu.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-getMenu",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "GetMenuLogGroup"
      ]
    },
    "PutMenuItemLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_tenants_menu/put_menu_item.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-putMenuItem",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "PutMenuItemLogGroup"
      ]
    },
    "CreateOrderLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_orders/create_order.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-createOrder",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "CreateOrderLogGroup"
      ]
    },
    "GetOrderLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_orders/get_order.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-getOrder",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "GetOrderLogGroup"
      ]
    },
    "ListOrdersLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_orders/list_orders.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-listOrders",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "ListOrdersLogGroup"
      ]
    },
    "GetOrderMetricsLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_orders/get_order_metrics.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-getOrderMetrics",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "GetOrderMetricsLogGroup"
      ]
    },
    "UpdateOrderStepLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_workflow/update_order_step.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-updateOrderStep",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "UpdateOrderStepLogGroup"
      ]
    },
    "GetDashboardSummaryLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_workflow/get_dashboard_summary.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-getDashboardSummary",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "GetDashboardSummaryLogGroup"
      ]
    },
    "CheckOrderStatusLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_workflow/check_order_status.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-checkOrderStatus",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "CheckOrderStatusLogGroup"
      ]
    },
    "CalculateOrderMetricsLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_workflow/calculate_order_metrics.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-calculateOrderMetrics",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "CalculateOrderMetricsLogGroup"
      ]
    },
    "SendEmailNotificationLambdaFunction": {
      "Type": "AWS::Lambda::Function",
      "Properties": {
        "Code": {
          "S3Bucket": {
            "Ref": "ServerlessDeploymentBucket"
          },
          "S3Key": "serverless/pardos-orders/dev/1764389245604-2025-11-29T04:07:25.604Z/pardos-orders.zip"
        },
        "Handler": "ms_notifications/send_email_notification.handler",
        "Runtime": "python3.11",
        "FunctionName": "pardos-orders-dev-sendEmailNotification",
        "MemorySize": 1024,
        "Timeout": 20,
        "Environment": {
          "Variables": {
            "TENANTS_TABLE": "dev-Tenants",
            "MENU_TABLE": "dev-MenuItems",
            "ORDERS_TABLE": "dev-Orders",
            "ORDER_EVENTS_TABLE": "dev-OrderEvents",
            "EVENTS_BUS_NAME": "dev-pardos-orders-bus",
            "REPORTS_BUCKET": "dev-pardos-orders-reports",
            "SNS_TOPIC_ARN": {
              "Ref": "OrderNotificationsTopic"
            }
          }
        },
        "Role": "arn:aws:iam::647796053987:role/LabRole"
      },
      "DependsOn": [
        "SendEmailNotificationLogGroup"
      ]
    },
    "GetTenantsLambdaVersionqHA0sCA8HX9N0ZDyuNMwOMQCOlccVvQzS4hZ4hA": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "GetTenantsLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "GetMenuLambdaVersionCxWWbGppkaP6kvoKI3TBidbGC2I8dA53KqXaJxYPmM": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "GetMenuLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "PutMenuItemLambdaVersioneeDnCUacAOSO3XhBGr6CDAQm442kx2GLBxCqISooTc": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "PutMenuItemLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "CreateOrderLambdaVersionbbkrBGFPmpo6ybd4W9qpdIdRWLDycFFrg2zSziwk8kY": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "CreateOrderLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "GetOrderLambdaVersionRf6b1dm0QdSCqtrtH9rdi8NiHomz1yFEP2gj1s03zFg": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "GetOrderLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "ListOrdersLambdaVersionAy4kPLTbrrT2yVFUX4xRJelQtrxKFkTqYr98XPf1c4": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "ListOrdersLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "GetOrderMetricsLambdaVersionDl7QZB3SCjVfht1YyF87jnE73n8JSGoh8NuSTon9Fo": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "GetOrderMetricsLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "UpdateOrderStepLambdaVersion2xqS5WC3HWKSgZVfPNHI0w2YtF9FIP4LB3hoLU0XeA": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "UpdateOrderStepLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "GetDashboardSummaryLambdaVersiondndUj3MHHMnXZEw72GCPinc15MIpSDXxPWak263qfQM": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "GetDashboardSummaryLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "CheckOrderStatusLambdaVersionBQs3HFNlxCqkZPpn16hyaev577LAlRdXwRGKbATPk": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "CheckOrderStatusLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "CalculateOrderMetricsLambdaVersionYxOpcgaChiCLlea0Pjbk3NCk3OSTjAGZ1FjJeLfmlis": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "CalculateOrderMetricsLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "SendEmailNotificationLambdaVersionPJAi580l2cNhapVuHcLJ5KCq3yKIUPHrFQTRjFAtdA": {
      "Type": "AWS::Lambda::Version",
      "DeletionPolicy": "Retain",
      "Properties": {
        "FunctionName": {
          "Ref": "SendEmailNotificationLambdaFunction"
        },
        "CodeSha256": "U27ukthWgoR6+pRXiL3CchsglOsqmAnkrZESoTlxGQU="
      }
    },
    "PardosordersdevsendEmailNotificationrule1EventBridgeRule": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "EventBusName": {
          "Fn::GetAtt": [
            "OrdersEventBus",
            "Name"
          ]
        },
        "EventPattern": {
          "source": [
            "pardos.orders"
          ],
          "detail-type": [
            "order.created",
            "order.updated"
          ]
        },
        "Name": "pardos-orders-dev-sendEmailNotification-rule-1",
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "SendEmailNotificationLambdaFunction",
                "Arn"
              ]
            },
            "Id": "pardos-orders-dev-sendEmailNotification-rule-1-target"
          }
        ]
      }
    },
    "SendEmailNotificationEventBridgeLambdaPermission1": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "FunctionName": {
          "Fn::GetAtt": [
            "SendEmailNotificationLambdaFunction",
            "Arn"
          ]
        },
        "Principal": "events.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            ":",
            [
              "arn",
              {
                "Ref": "AWS::Partition"
              },
              "events",
              {
                "Ref": "AWS::Region"
              },
              {
                "Ref": "AWS::AccountId"
              },
              {
                "Fn::Join": [
                  "/",
                  [
                    "rule",
                    {
                      "Fn::GetAtt": [
                        "OrdersEventBus",
                        "Name"
                      ]
                    },
                    "pardos-orders-dev-sendEmailNotification-rule-1"
                  ]
                ]
              }
            ]
          ]
        }
      }
    },
    "HttpApi": {
      "Type": "AWS::ApiGatewayV2::Api",
      "Properties": {
        "Name": "dev-pardos-orders",
        "ProtocolType": "HTTP",
        "CorsConfiguration": {
          "AllowHeaders": [
            "Content-Type",
            "X-Amz-Date",
            "Authorization",
            "X-Api-Key",
            "X-Amz-Security-Token",
            "X-Amz-User-Agent",
            "X-Amzn-Trace-Id"
          ],
          "AllowMethods": [
            "OPTIONS",
            "GET",
            "POST"
          ],
          "AllowOrigins": [
            "*"
          ]
        }
      }
    },
    "HttpApiStage": {
      "Type": "AWS::ApiGatewayV2::Stage",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "StageName": "$default",
        "AutoDeploy": true,
        "DefaultRouteSettings": {
          "DetailedMetricsEnabled": false
        }
      }
    },
    "GetTenantsLambdaPermissionHttpApi": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "GetTenantsLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "HttpApi"
              },
              "/*"
            ]
          ]
        }
      }
    },
    "HttpApiIntegrationGetTenants": {
      "Type": "AWS::ApiGatewayV2::Integration",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "GetTenantsLambdaFunction",
            "Arn"
          ]
        },
        "PayloadFormatVersion": "2.0",
        "TimeoutInMillis": 30000
      }
    },
    "HttpApiRouteGetTenants": {
      "Type": "AWS::ApiGatewayV2::Route",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "RouteKey": "GET /tenants",
        "Target": {
          "Fn::Join": [
            "/",
            [
              "integrations",
              {
                "Ref": "HttpApiIntegrationGetTenants"
              }
            ]
          ]
        }
      },
      "DependsOn": "HttpApiIntegrationGetTenants"
    },
    "GetMenuLambdaPermissionHttpApi": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "GetMenuLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "HttpApi"
              },
              "/*"
            ]
          ]
        }
      }
    },
    "HttpApiIntegrationGetMenu": {
      "Type": "AWS::ApiGatewayV2::Integration",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "GetMenuLambdaFunction",
            "Arn"
          ]
        },
        "PayloadFormatVersion": "2.0",
        "TimeoutInMillis": 30000
      }
    },
    "HttpApiRouteGetTenantsTenantidVarMenu": {
      "Type": "AWS::ApiGatewayV2::Route",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "RouteKey": "GET /tenants/{tenantId}/menu",
        "Target": {
          "Fn::Join": [
            "/",
            [
              "integrations",
              {
                "Ref": "HttpApiIntegrationGetMenu"
              }
            ]
          ]
        }
      },
      "DependsOn": "HttpApiIntegrationGetMenu"
    },
    "PutMenuItemLambdaPermissionHttpApi": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "PutMenuItemLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "HttpApi"
              },
              "/*"
            ]
          ]
        }
      }
    },
    "HttpApiIntegrationPutMenuItem": {
      "Type": "AWS::ApiGatewayV2::Integration",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "PutMenuItemLambdaFunction",
            "Arn"
          ]
        },
        "PayloadFormatVersion": "2.0",
        "TimeoutInMillis": 30000
      }
    },
    "HttpApiRoutePostTenantsTenantidVarMenu": {
      "Type": "AWS::ApiGatewayV2::Route",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "RouteKey": "POST /tenants/{tenantId}/menu",
        "Target": {
          "Fn::Join": [
            "/",
            [
              "integrations",
              {
                "Ref": "HttpApiIntegrationPutMenuItem"
              }
            ]
          ]
        }
      },
      "DependsOn": "HttpApiIntegrationPutMenuItem"
    },
    "CreateOrderLambdaPermissionHttpApi": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "CreateOrderLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "HttpApi"
              },
              "/*"
            ]
          ]
        }
      }
    },
    "HttpApiIntegrationCreateOrder": {
      "Type": "AWS::ApiGatewayV2::Integration",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "CreateOrderLambdaFunction",
            "Arn"
          ]
        },
        "PayloadFormatVersion": "2.0",
        "TimeoutInMillis": 30000
      }
    },
    "HttpApiRoutePostTenantsTenantidVarOrders": {
      "Type": "AWS::ApiGatewayV2::Route",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "RouteKey": "POST /tenants/{tenantId}/orders",
        "Target": {
          "Fn::Join": [
            "/",
            [
              "integrations",
              {
                "Ref": "HttpApiIntegrationCreateOrder"
              }
            ]
          ]
        }
      },
      "DependsOn": "HttpApiIntegrationCreateOrder"
    },
    "GetOrderLambdaPermissionHttpApi": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "GetOrderLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "HttpApi"
              },
              "/*"
            ]
          ]
        }
      }
    },
    "HttpApiIntegrationGetOrder": {
      "Type": "AWS::ApiGatewayV2::Integration",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "GetOrderLambdaFunction",
            "Arn"
          ]
        },
        "PayloadFormatVersion": "2.0",
        "TimeoutInMillis": 30000
      }
    },
    "HttpApiRouteGetTenantsTenantidVarOrdersOrderidVar": {
      "Type": "AWS::ApiGatewayV2::Route",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "RouteKey": "GET /tenants/{tenantId}/orders/{orderId}",
        "Target": {
          "Fn::Join": [
            "/",
            [
              "integrations",
              {
                "Ref": "HttpApiIntegrationGetOrder"
              }
            ]
          ]
        }
      },
      "DependsOn": "HttpApiIntegrationGetOrder"
    },
    "ListOrdersLambdaPermissionHttpApi": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "ListOrdersLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "HttpApi"
              },
              "/*"
            ]
          ]
        }
      }
    },
    "HttpApiIntegrationListOrders": {
      "Type": "AWS::ApiGatewayV2::Integration",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "ListOrdersLambdaFunction",
            "Arn"
          ]
        },
        "PayloadFormatVersion": "2.0",
        "TimeoutInMillis": 30000
      }
    },
    "HttpApiRouteGetTenantsTenantidVarOrders": {
      "Type": "AWS::ApiGatewayV2::Route",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "RouteKey": "GET /tenants/{tenantId}/orders",
        "Target": {
          "Fn::Join": [
            "/",
            [
              "integrations",
              {
                "Ref": "HttpApiIntegrationListOrders"
              }
            ]
          ]
        }
      },
      "DependsOn": "HttpApiIntegrationListOrders"
    },
    "GetOrderMetricsLambdaPermissionHttpApi": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "GetOrderMetricsLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "HttpApi"
              },
              "/*"
            ]
          ]
        }
      }
    },
    "HttpApiIntegrationGetOrderMetrics": {
      "Type": "AWS::ApiGatewayV2::Integration",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "GetOrderMetricsLambdaFunction",
            "Arn"
          ]
        },
        "PayloadFormatVersion": "2.0",
        "TimeoutInMillis": 30000
      }
    },
    "HttpApiRouteGetTenantsTenantidVarOrdersOrderidVarMetrics": {
      "Type": "AWS::ApiGatewayV2::Route",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "RouteKey": "GET /tenants/{tenantId}/orders/{orderId}/metrics",
        "Target": {
          "Fn::Join": [
            "/",
            [
              "integrations",
              {
                "Ref": "HttpApiIntegrationGetOrderMetrics"
              }
            ]
          ]
        }
      },
      "DependsOn": "HttpApiIntegrationGetOrderMetrics"
    },
    "UpdateOrderStepLambdaPermissionHttpApi": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "UpdateOrderStepLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "HttpApi"
              },
              "/*"
            ]
          ]
        }
      }
    },
    "HttpApiIntegrationUpdateOrderStep": {
      "Type": "AWS::ApiGatewayV2::Integration",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "UpdateOrderStepLambdaFunction",
            "Arn"
          ]
        },
        "PayloadFormatVersion": "2.0",
        "TimeoutInMillis": 30000
      }
    },
    "HttpApiRoutePostTenantsTenantidVarOrdersOrderidVarStep": {
      "Type": "AWS::ApiGatewayV2::Route",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "RouteKey": "POST /tenants/{tenantId}/orders/{orderId}/step",
        "Target": {
          "Fn::Join": [
            "/",
            [
              "integrations",
              {
                "Ref": "HttpApiIntegrationUpdateOrderStep"
              }
            ]
          ]
        }
      },
      "DependsOn": "HttpApiIntegrationUpdateOrderStep"
    },
    "GetDashboardSummaryLambdaPermissionHttpApi": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "FunctionName": {
          "Fn::GetAtt": [
            "GetDashboardSummaryLambdaFunction",
            "Arn"
          ]
        },
        "Action": "lambda:InvokeFunction",
        "Principal": "apigateway.amazonaws.com",
        "SourceArn": {
          "Fn::Join": [
            "",
            [
              "arn:",
              {
                "Ref": "AWS::Partition"
              },
              ":execute-api:",
              {
                "Ref": "AWS::Region"
              },
              ":",
              {
                "Ref": "AWS::AccountId"
              },
              ":",
              {
                "Ref": "HttpApi"
              },
              "/*"
            ]
          ]
        }
      }
    },
    "HttpApiIntegrationGetDashboardSummary": {
      "Type": "AWS::ApiGatewayV2::Integration",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "IntegrationType": "AWS_PROXY",
        "IntegrationUri": {
          "Fn::GetAtt": [
            "GetDashboardSummaryLambdaFunction",
            "Arn"
          ]
        },
        "PayloadFormatVersion": "2.0",
        "TimeoutInMillis": 30000
      }
    },
    "HttpApiRouteGetTenantsTenantidVarDashboard": {
      "Type": "AWS::ApiGatewayV2::Route",
      "Properties": {
        "ApiId": {
          "Ref": "HttpApi"
        },
        "RouteKey": "GET /tenants/{tenantId}/dashboard",
        "Target": {
          "Fn::Join": [
            "/",
            [
              "integrations",
              {
                "Ref": "HttpApiIntegrationGetDashboardSummary"
              }
            ]
          ]
        }
      },
      "DependsOn": "HttpApiIntegrationGetDashboardSummary"
    },
    "OrderNotificationsTopic": {
      "Type": "AWS::SNS::Topic",
      "Properties": {
        "TopicName": "dev-pardos-order-notifications",
        "DisplayName": "Pardos Chicken - Notificaciones de Pedidos"
      }
    },
    "TenantsTable": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "TableName": "dev-Tenants",
        "AttributeDefinitions": [
          {
            "AttributeName": "tenant_id",
            "AttributeType": "S"
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "tenant_id",
            "KeyType": "HASH"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST"
      }
    },
    "MenuTable": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "TableName": "dev-MenuItems",
        "AttributeDefinitions": [
          {
            "AttributeName": "tenant_id",
            "AttributeType": "S"
          },
          {
            "AttributeName": "product_id",
            "AttributeType": "S"
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "tenant_id",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "product_id",
            "KeyType": "RANGE"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST"
      }
    },
    "OrdersTable": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "TableName": "dev-Orders",
        "AttributeDefinitions": [
          {
            "AttributeName": "tenant_id",
            "AttributeType": "S"
          },
          {
            "AttributeName": "order_id",
            "AttributeType": "S"
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "tenant_id",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "order_id",
            "KeyType": "RANGE"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST"
      }
    },
    "OrderEventsTable": {
      "Type": "AWS::DynamoDB::Table",
      "Properties": {
        "TableName": "dev-OrderEvents",
        "AttributeDefinitions": [
          {
            "AttributeName": "order_id",
            "AttributeType": "S"
          },
          {
            "AttributeName": "ts",
            "AttributeType": "S"
          }
        ],
        "KeySchema": [
          {
            "AttributeName": "order_id",
            "KeyType": "HASH"
          },
          {
            "AttributeName": "ts",
            "KeyType": "RANGE"
          }
        ],
        "BillingMode": "PAY_PER_REQUEST"
      }
    },
    "OrdersEventBus": {
      "Type": "AWS::Events::EventBus",
      "Properties": {
        "Name": "dev-pardos-orders-bus"
      }
    },
    "OrderCreatedRule": {
      "Type": "AWS::Events::Rule",
      "Properties": {
        "Name": "dev-order-created-trigger",
        "Description": "Inicia el workflow de Step Functions cuando se crea una nueva orden",
        "EventBusName": {
          "Ref": "OrdersEventBus"
        },
        "EventPattern": {
          "source": [
            "pardos.orders"
          ],
          "detail-type": [
            "order.created"
          ]
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Fn::GetAtt": [
                "OrderWorkflowStateMachine",
                "Arn"
              ]
            },
            "RoleArn": "arn:aws:iam::647796053987:role/LabRole",
            "Id": "OrderWorkflowTarget",
            "InputTransformer": {
              "InputPathsMap": {
                "tenant_id": "$.detail.tenant_id",
                "order_id": "$.detail.order_id",
                "status": "$.detail.status"
              },
              "InputTemplate": "{\n  \"tenant_id\": <tenant_id>,\n  \"order_id\": <order_id>,\n  \"status\": <status>\n}\n"
            }
          }
        ]
      }
    },
    "OrderWorkflowStateMachine": {
      "Type": "AWS::StepFunctions::StateMachine",
      "Properties": {
        "StateMachineName": "dev-pardos-order-workflow",
        "StateMachineType": "STANDARD",
        "RoleArn": "arn:aws:iam::647796053987:role/LabRole",
        "DefinitionString": {
          "Fn::Sub": "{\n  \"Comment\": \"Workflow de gestión de pedidos Pardos Chicken con monitoreo de tiempos\",\n  \"StartAt\": \"LogOrderReceived\",\n  \"States\": {\n    \"LogOrderReceived\": {\n      \"Type\": \"Pass\",\n      \"Comment\": \"Registrar que la orden fue recibida\",\n      \"Parameters\": {\n        \"tenant_id.$\": \"$.tenant_id\",\n        \"order_id.$\": \"$.order_id\",\n        \"status\": \"RECEIVED\",\n        \"timestamp.$\": \"$$.State.EnteredTime\"\n      },\n      \"Next\": \"CheckInitialStatus\"\n    },\n    \"CheckInitialStatus\": {\n      \"Type\": \"Task\",\n      \"Comment\": \"Verificar estado inicial de la orden\",\n      \"Resource\": \"arn:aws:states:::lambda:invoke\",\n      \"Parameters\": {\n        \"FunctionName\": \"${CheckOrderStatusLambdaFunction}\",\n        \"Payload\": {\n          \"tenant_id.$\": \"$.tenant_id\",\n          \"order_id.$\": \"$.order_id\"\n        }\n      },\n      \"ResultPath\": \"$.checkResult\",\n      \"Retry\": [\n        {\n          \"ErrorEquals\": [\"States.TaskFailed\"],\n          \"IntervalSeconds\": 2,\n          \"MaxAttempts\": 3,\n          \"BackoffRate\": 2.0\n        }\n      ],\n      \"Catch\": [\n        {\n          \"ErrorEquals\": [\"States.ALL\"],\n          \"Next\": \"HandleError\",\n          \"ResultPath\": \"$.error\"\n        }\n      ],\n      \"Next\": \"WaitForCooking\"\n    },\n    \"WaitForCooking\": {\n      \"Type\": \"Wait\",\n      \"Comment\": \"Esperar mientras el personal cocina (workflow manual)\",\n      \"Seconds\": 300,\n      \"Next\": \"CheckCookingStatus\"\n    },\n    \"CheckCookingStatus\": {\n      \"Type\": \"Task\",\n      \"Comment\": \"Verificar si pasó a fase de cocina\",\n      \"Resource\": \"arn:aws:states:::lambda:invoke\",\n      \"Parameters\": {\n        \"FunctionName\": \"${CheckOrderStatusLambdaFunction}\",\n        \"Payload\": {\n          \"tenant_id.$\": \"$.tenant_id\",\n          \"order_id.$\": \"$.order_id\"\n        }\n      },\n      \"ResultPath\": \"$.checkResult\",\n      \"Retry\": [\n        {\n          \"ErrorEquals\": [\"States.TaskFailed\"],\n          \"IntervalSeconds\": 2,\n          \"MaxAttempts\": 3,\n          \"BackoffRate\": 2.0\n        }\n      ],\n      \"Next\": \"IsCooking\"\n    },\n    \"IsCooking\": {\n      \"Type\": \"Choice\",\n      \"Comment\": \"Verificar si ya está en cocina o más adelante\",\n      \"Choices\": [\n        {\n          \"Variable\": \"$.checkResult.Payload.current_status\",\n          \"StringEquals\": \"RECEIVED\",\n          \"Next\": \"WaitForCooking\"\n        },\n        {\n          \"Or\": [\n            {\n              \"Variable\": \"$.checkResult.Payload.current_status\",\n              \"StringEquals\": \"COOKING\"\n            },\n            {\n              \"Variable\": \"$.checkResult.Payload.current_status\",\n              \"StringEquals\": \"PACKING\"\n            },\n            {\n              \"Variable\": \"$.checkResult.Payload.current_status\",\n              \"StringEquals\": \"DELIVERING\"\n            },\n            {\n              \"Variable\": \"$.checkResult.Payload.current_status\",\n              \"StringEquals\": \"DELIVERED\"\n            }\n          ],\n          \"Next\": \"WaitForPacking\"\n        }\n      ],\n      \"Default\": \"WaitForCooking\"\n    },\n    \"WaitForPacking\": {\n      \"Type\": \"Wait\",\n      \"Comment\": \"Esperar mientras el personal empaca\",\n      \"Seconds\": 180,\n      \"Next\": \"CheckPackingStatus\"\n    },\n    \"CheckPackingStatus\": {\n      \"Type\": \"Task\",\n      \"Comment\": \"Verificar si pasó a fase de empaque\",\n      \"Resource\": \"arn:aws:states:::lambda:invoke\",\n      \"Parameters\": {\n        \"FunctionName\": \"${CheckOrderStatusLambdaFunction}\",\n        \"Payload\": {\n          \"tenant_id.$\": \"$.tenant_id\",\n          \"order_id.$\": \"$.order_id\"\n        }\n      },\n      \"ResultPath\": \"$.checkResult\",\n      \"Retry\": [\n        {\n          \"ErrorEquals\": [\"States.TaskFailed\"],\n          \"IntervalSeconds\": 2,\n          \"MaxAttempts\": 3,\n          \"BackoffRate\": 2.0\n        }\n      ],\n      \"Next\": \"IsPacking\"\n    },\n    \"IsPacking\": {\n      \"Type\": \"Choice\",\n      \"Comment\": \"Verificar si ya está en empaque o más adelante\",\n      \"Choices\": [\n        {\n          \"Or\": [\n            {\n              \"Variable\": \"$.checkResult.Payload.current_status\",\n              \"StringEquals\": \"RECEIVED\"\n            },\n            {\n              \"Variable\": \"$.checkResult.Payload.current_status\",\n              \"StringEquals\": \"COOKING\"\n            }\n          ],\n          \"Next\": \"WaitForPacking\"\n        },\n        {\n          \"Or\": [\n            {\n              \"Variable\": \"$.checkResult.Payload.current_status\",\n              \"StringEquals\": \"PACKING\"\n            },\n            {\n              \"Variable\": \"$.checkResult.Payload.current_status\",\n              \"StringEquals\": \"DELIVERING\"\n            },\n            {\n              \"Variable\": \"$.checkResult.Payload.current_status\",\n              \"StringEquals\": \"DELIVERED\"\n            }\n          ],\n          \"Next\": \"WaitForDelivery\"\n        }\n      ],\n      \"Default\": \"WaitForPacking\"\n    },\n    \"WaitForDelivery\": {\n      \"Type\": \"Wait\",\n      \"Comment\": \"Esperar mientras el repartidor entrega\",\n      \"Seconds\": 600,\n      \"Next\": \"CheckDeliveryStatus\"\n    },\n    \"CheckDeliveryStatus\": {\n      \"Type\": \"Task\",\n      \"Comment\": \"Verificar si está siendo entregado o ya entregado\",\n      \"Resource\": \"arn:aws:states:::lambda:invoke\",\n      \"Parameters\": {\n        \"FunctionName\": \"${CheckOrderStatusLambdaFunction}\",\n        \"Payload\": {\n          \"tenant_id.$\": \"$.tenant_id\",\n          \"order_id.$\": \"$.order_id\"\n        }\n      },\n      \"ResultPath\": \"$.checkResult\",\n      \"Retry\": [\n        {\n          \"ErrorEquals\": [\"States.TaskFailed\"],\n          \"IntervalSeconds\": 2,\n          \"MaxAttempts\": 3,\n          \"BackoffRate\": 2.0\n        }\n      ],\n      \"Next\": \"IsDelivered\"\n    },\n    \"IsDelivered\": {\n      \"Type\": \"Choice\",\n      \"Comment\": \"Verificar si ya fue entregado\",\n      \"Choices\": [\n        {\n          \"Variable\": \"$.checkResult.Payload.current_status\",\n          \"StringEquals\": \"DELIVERED\",\n          \"Next\": \"CalculateFinalMetrics\"\n        }\n      ],\n      \"Default\": \"WaitForDelivery\"\n    },\n    \"CalculateFinalMetrics\": {\n      \"Type\": \"Task\",\n      \"Comment\": \"Calcular métricas finales de tiempo de la orden\",\n      \"Resource\": \"arn:aws:states:::lambda:invoke\",\n      \"Parameters\": {\n        \"FunctionName\": \"${CalculateOrderMetricsLambdaFunction}\",\n        \"Payload\": {\n          \"order_id.$\": \"$.order_id\"\n        }\n      },\n      \"ResultPath\": \"$.metricsResult\",\n      \"Retry\": [\n        {\n          \"ErrorEquals\": [\"States.TaskFailed\"],\n          \"IntervalSeconds\": 2,\n          \"MaxAttempts\": 3,\n          \"BackoffRate\": 2.0\n        }\n      ],\n      \"Next\": \"WorkflowCompleted\"\n    },\n    \"WorkflowCompleted\": {\n      \"Type\": \"Succeed\",\n      \"Comment\": \"Workflow completado exitosamente\"\n    },\n    \"HandleError\": {\n      \"Type\": \"Pass\",\n      \"Comment\": \"Manejar errores del workflow\",\n      \"Parameters\": {\n        \"error.$\": \"$.error\",\n        \"order_id.$\": \"$.order_id\"\n      },\n      \"Next\": \"WorkflowFailed\"\n    },\n    \"WorkflowFailed\": {\n      \"Type\": \"Fail\",\n      \"Comment\": \"Workflow falló\",\n      \"Error\": \"WorkflowExecutionError\",\n      \"Cause\": \"Error durante la ejecución del workflow de pedidos\"\n    }\n  }\n}\n"
        }
      }
    }
  },
  "Outputs": {
    "ServerlessDeploymentBucketName": {
      "Value": {
        "Ref": "ServerlessDeploymentBucket"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-ServerlessDeploymentBucketName"
      }
    },
    "GetTenantsLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "GetTenantsLambdaVersionqHA0sCA8HX9N0ZDyuNMwOMQCOlccVvQzS4hZ4hA"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-GetTenantsLambdaFunctionQualifiedArn"
      }
    },
    "GetMenuLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "GetMenuLambdaVersionCxWWbGppkaP6kvoKI3TBidbGC2I8dA53KqXaJxYPmM"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-GetMenuLambdaFunctionQualifiedArn"
      }
    },
    "PutMenuItemLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "PutMenuItemLambdaVersioneeDnCUacAOSO3XhBGr6CDAQm442kx2GLBxCqISooTc"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-PutMenuItemLambdaFunctionQualifiedArn"
      }
    },
    "CreateOrderLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "CreateOrderLambdaVersionbbkrBGFPmpo6ybd4W9qpdIdRWLDycFFrg2zSziwk8kY"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-CreateOrderLambdaFunctionQualifiedArn"
      }
    },
    "GetOrderLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "GetOrderLambdaVersionRf6b1dm0QdSCqtrtH9rdi8NiHomz1yFEP2gj1s03zFg"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-GetOrderLambdaFunctionQualifiedArn"
      }
    },
    "ListOrdersLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "ListOrdersLambdaVersionAy4kPLTbrrT2yVFUX4xRJelQtrxKFkTqYr98XPf1c4"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-ListOrdersLambdaFunctionQualifiedArn"
      }
    },
    "GetOrderMetricsLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "GetOrderMetricsLambdaVersionDl7QZB3SCjVfht1YyF87jnE73n8JSGoh8NuSTon9Fo"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-GetOrderMetricsLambdaFunctionQualifiedArn"
      }
    },
    "UpdateOrderStepLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "UpdateOrderStepLambdaVersion2xqS5WC3HWKSgZVfPNHI0w2YtF9FIP4LB3hoLU0XeA"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-UpdateOrderStepLambdaFunctionQualifiedArn"
      }
    },
    "GetDashboardSummaryLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "GetDashboardSummaryLambdaVersiondndUj3MHHMnXZEw72GCPinc15MIpSDXxPWak263qfQM"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-GetDashboardSummaryLambdaFunctionQualifiedArn"
      }
    },
    "CheckOrderStatusLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "CheckOrderStatusLambdaVersionBQs3HFNlxCqkZPpn16hyaev577LAlRdXwRGKbATPk"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-CheckOrderStatusLambdaFunctionQualifiedArn"
      }
    },
    "CalculateOrderMetricsLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "CalculateOrderMetricsLambdaVersionYxOpcgaChiCLlea0Pjbk3NCk3OSTjAGZ1FjJeLfmlis"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-CalculateOrderMetricsLambdaFunctionQualifiedArn"
      }
    },
    "SendEmailNotificationLambdaFunctionQualifiedArn": {
      "Description": "Current Lambda function version",
      "Value": {
        "Ref": "SendEmailNotificationLambdaVersionPJAi580l2cNhapVuHcLJ5KCq3yKIUPHrFQTRjFAtdA"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-SendEmailNotificationLambdaFunctionQualifiedArn"
      }
    },
    "HttpApiId": {
      "Description": "Id of the HTTP API",
      "Value": {
        "Ref": "HttpApi"
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-HttpApiId"
      }
    },
    "HttpApiUrl": {
      "Description": "URL of the HTTP API",
      "Value": {
        "Fn::Join": [
          "",
          [
            "https://",
            {
              "Ref": "HttpApi"
            },
            ".execute-api.",
            {
              "Ref": "AWS::Region"
            },
            ".",
            {
              "Ref": "AWS::URLSuffix"
            }
          ]
        ]
      },
      "Export": {
        "Name": "sls-pardos-orders-dev-HttpApiUrl"
      }
    }
  }
}